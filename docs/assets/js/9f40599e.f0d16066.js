"use strict";(self.webpackChunkcyberdocs=self.webpackChunkcyberdocs||[]).push([[2454],{3905:(e,a,t)=>{t.d(a,{Zo:()=>c,kt:()=>g});var n=t(7294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function l(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function s(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?l(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function o(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)t=l[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)t=l[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var i=n.createContext({}),u=function(e){var a=n.useContext(i),t=a;return e&&(t="function"==typeof e?e(a):s(s({},a),e)),t},c=function(e){var a=u(e.components);return n.createElement(i.Provider,{value:a},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},m=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,l=e.originalType,i=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),p=u(t),m=r,g=p["".concat(i,".").concat(m)]||p[m]||d[m]||l;return t?n.createElement(g,s(s({ref:a},c),{},{components:t})):n.createElement(g,s({ref:a},c))}));function g(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var l=t.length,s=new Array(l);s[0]=m;var o={};for(var i in a)hasOwnProperty.call(a,i)&&(o[i]=a[i]);o.originalType=e,o[p]="string"==typeof e?e:r,s[1]=o;for(var u=2;u<l;u++)s[u]=t[u];return n.createElement.apply(null,s)}return n.createElement.apply(null,t)}m.displayName="MDXCreateElement"},7003:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>i,contentTitle:()=>s,default:()=>d,frontMatter:()=>l,metadata:()=>o,toc:()=>u});var n=t(7462),r=(t(7294),t(3905));const l={sidebar_position:10},s="IPTables - Cortafuegos",o={unversionedId:"MF0487_3/herramientas_auditoria/firewall_iptables",id:"MF0487_3/herramientas_auditoria/firewall_iptables",title:"IPTables - Cortafuegos",description:"Iptables es un firewall de software incluido en la mayor\xeda de las distribuciones de Linux que controla el tr\xe1fico de red entrante y saliente en un sistema. Su funci\xf3n es permitir o denegar el tr\xe1fico de red basado en reglas configuradas por el usuario.",source:"@site/docs/MF0487_3/herramientas_auditoria/firewall_iptables.md",sourceDirName:"MF0487_3/herramientas_auditoria",slug:"/MF0487_3/herramientas_auditoria/firewall_iptables",permalink:"/IFCT0109/docs/MF0487_3/herramientas_auditoria/firewall_iptables",draft:!1,tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10},sidebar:"tutorialSidebar",previous:{title:"Otras herramientas de Auditoria Inform\xe1tica",permalink:"/IFCT0109/docs/MF0487_3/herramientas_auditoria/otras_herramientas_auditoria"},next:{title:"John the Ripper",permalink:"/IFCT0109/docs/MF0487_3/herramientas_auditoria/john_the_ripper"}},i={},u=[{value:"C\xf3mo funciona iptables",id:"c\xf3mo-funciona-iptables",level:2},{value:"Tablas y cadenas",id:"tablas-y-cadenas",level:2},{value:"Filter",id:"filter",level:3},{value:"Network Address Translation (NAT)",id:"network-address-translation-nat",level:3},{value:"Mangle",id:"mangle",level:3},{value:"Raw - Sin Procesar",id:"raw---sin-procesar",level:3},{value:"Seguridad (Opcional)",id:"seguridad-opcional",level:3},{value:"Objetivos",id:"objetivos",level:2},{value:"Instalaci\xf3n de Iptables",id:"instalaci\xf3n-de-iptables",level:2},{value:"Comandos m\xe1s habituales",id:"comandos-m\xe1s-habituales",level:2},{value:"Definir las reglas de la cadena",id:"definir-las-reglas-de-la-cadena",level:2},{value:"Permitir el tr\xe1fico en Localhost",id:"permitir-el-tr\xe1fico-en-localhost",level:2},{value:"Permitir conexiones a trav\xe9s de los puertos HTTP, SSH y SSL",id:"permitir-conexiones-a-trav\xe9s-de-los-puertos-http-ssh-y-ssl",level:2},{value:"Permitir s\xf3lo SSH",id:"permitir-s\xf3lo-ssh",level:3},{value:"Filtrado de paquetes basado en el origen (SOURCE)",id:"filtrado-de-paquetes-basado-en-el-origen-source",level:2},{value:"Descartar (DROP) el resto del tr\xe1fico",id:"descartar-drop-el-resto-del-tr\xe1fico",level:2},{value:"Borrar Reglas",id:"borrar-reglas",level:2},{value:"Cambios permanentes",id:"cambios-permanentes",level:2},{value:"Recursos",id:"recursos",level:2}],c={toc:u},p="wrapper";function d(e){let{components:a,...t}=e;return(0,r.kt)(p,(0,n.Z)({},c,t,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"iptables---cortafuegos"},"IPTables - Cortafuegos"),(0,r.kt)("p",null,"Iptables es un firewall de software incluido en la mayor\xeda de las distribuciones de Linux que controla el tr\xe1fico de red entrante y saliente en un sistema. Su funci\xf3n es permitir o denegar el tr\xe1fico de red basado en reglas configuradas por el usuario."),(0,r.kt)("p",null,"Iptables utiliza tablas para almacenar y organizar las reglas de firewall, que se aplican a paquetes de red en funci\xf3n de ciertos criterios como la direcci\xf3n IP, el puerto de origen y destino, el protocolo utilizado y la interfaz de red."),(0,r.kt)("p",null,"Las reglas de iptables se definen en cadenas, que son secuencias de reglas aplicadas a paquetes de red. Hay cinco cadenas predefinidas: INPUT, OUTPUT, FORWARD, PREROUTING y POSTROUTING, que controlan el tr\xe1fico de red que llega al sistema, sale del sistema, se reenv\xeda a trav\xe9s del sistema, se redirecciona antes de que se env\xede o despu\xe9s de que se reciba."),(0,r.kt)("p",null,"Iptables tambi\xe9n tiene la capacidad de crear reglas personalizadas para adaptarse a las necesidades espec\xedficas de una organizaci\xf3n o usuario. Las reglas se pueden configurar mediante el uso de comandos de l\xednea de comandos o utilizando herramientas de configuraci\xf3n gr\xe1ficas."),(0,r.kt)("h2",{id:"c\xf3mo-funciona-iptables"},"C\xf3mo funciona iptables"),(0,r.kt)("p",null,"El tr\xe1fico de red se compone de paquetes. Los datos se dividen en trozos m\xe1s peque\xf1os (llamados paquetes), se env\xedan por la red y luego se vuelven a unir. Iptables identifica los paquetes recibidos y utiliza un conjunto de reglas para decidir qu\xe9 hacer con ellos."),(0,r.kt)("p",null,"Iptables filtra los paquetes bas\xe1ndose en:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Tablas"),": Las tablas son archivos que unen acciones similares. Una ",(0,r.kt)("strong",{parentName:"li"},"tabla")," consiste en varias ",(0,r.kt)("strong",{parentName:"li"},"cadenas"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Cadenas"),": Una cadena es una cadena de ",(0,r.kt)("strong",{parentName:"li"},"reglas"),". Cuando se recibe un paquete, iptables busca la tabla apropiada y lo ejecuta a trav\xe9s de la cadena de reglas hasta que encuentra una coincidencia."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Reglas"),": Una regla es una declaraci\xf3n que le dice al sistema qu\xe9 hacer con un paquete. Las reglas pueden bloquear un tipo de paquete, o reenviar otro tipo de paquete. El resultado, el lugar al que se env\xeda un paquete, se denomina ",(0,r.kt)("strong",{parentName:"li"},"objetivo"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Objetivos"),": Un objetivo es una decisi\xf3n sobre qu\xe9 hacer con un paquete. Normalmente, se trata de aceptarlo, descartarlo o rechazarlo (lo que devuelve un error al remitente).")),(0,r.kt)("h2",{id:"tablas-y-cadenas"},"Tablas y cadenas"),(0,r.kt)("p",null,"El cortafuegos de Linux iptables tiene cuatro tablas por defecto. A continuaci\xf3n se enumeran las cuatro junto con las cadenas que cada tabla contiene."),(0,r.kt)("h3",{id:"filter"},"Filter"),(0,r.kt)("p",null,"La tabla Filter es la m\xe1s utilizada. Act\xfaa como un portero, decidiendo qui\xe9n entra y qui\xe9n sale de tu red. Tiene las siguientes cadenas por defecto:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Input (Entrada)")," - las reglas en esta cadena controlan los paquetes recibidos por el servidor."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Output (Salida)")," - esta cadena controla los paquetes para el tr\xe1fico saliente."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Forward (Reenvio)")," - este conjunto de reglas controla los paquetes que son enrutados a trav\xe9s del servidor.")),(0,r.kt)("h3",{id:"network-address-translation-nat"},"Network Address Translation (NAT)"),(0,r.kt)("p",null,"Esta tabla contiene reglas NAT (Network Address Translation) para enrutar paquetes a redes a las que no se puede acceder directamente. Cuando hay que modificar el destino o el origen del paquete, se utiliza la tabla NAT. Incluye las siguientes cadenas:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Prerouting")," - esta cadena asigna los paquetes en cuanto el servidor los recibe."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Output")," - funciona igual que la cadena de salida que describimos en la tabla de filtros."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Postrouting")," - las reglas de esta cadena permiten hacer cambios en los paquetes despu\xe9s de que salgan de la cadena de salida.")),(0,r.kt)("h3",{id:"mangle"},"Mangle"),(0,r.kt)("p",null,"La tabla Mangle ajusta las propiedades de la cabecera IP de los paquetes. La tabla tiene todas las siguientes cadenas que se han descrito anteriormente:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Prerouting"),(0,r.kt)("li",{parentName:"ul"},"Postrouting"),(0,r.kt)("li",{parentName:"ul"},"Output"),(0,r.kt)("li",{parentName:"ul"},"Input"),(0,r.kt)("li",{parentName:"ul"},"Forward")),(0,r.kt)("h3",{id:"raw---sin-procesar"},"Raw - Sin Procesar"),(0,r.kt)("p",null,"La tabla Raw se utiliza para eximir a los paquetes del seguimiento de conexiones. La tabla Raw tiene dos de las cadenas que anteriormente se mencionaron:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Prerouting"),(0,r.kt)("li",{parentName:"ul"},"Output")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://phoenixnap.com/kb/wp-content/uploads/2021/04/iptables-diagram.png",alt:"Diagrama IPTables",title:"Diagrama IPTables"})),(0,r.kt)("h3",{id:"seguridad-opcional"},"Seguridad (Opcional)"),(0,r.kt)("p",null,"Algunas versiones de Linux tambi\xe9n utilizan una tabla de Seguridad para gestionar reglas de acceso especiales. Esta tabla incluye cadenas de ",(0,r.kt)("strong",{parentName:"p"},"entrada, salida y reenv\xedo"),", de forma muy similar a la tabla de filtros."),(0,r.kt)("h2",{id:"objetivos"},"Objetivos"),(0,r.kt)("p",null,"Un objetivo es lo que ocurre despu\xe9s de que un paquete coincida con los criterios de una regla. Los objetivos sin terminaci\xf3n siguen comparando los paquetes con las reglas de una cadena incluso cuando el paquete coincide con una regla."),(0,r.kt)("p",null,"Con los objetivos de terminaci\xf3n, un paquete se eval\xfaa inmediatamente y no se compara con otra cadena. Los objetivos finales en Linux iptables son:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Accept")," - esta regla acepta que los paquetes atraviesen el cortafuegos de iptables."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Drop")," - el paquete descartado no se compara con ninguna otra cadena. Cuando iptables descarta una conexi\xf3n entrante a su servidor, el usuario que intenta conectarse no recibe ning\xfan error. Parece como si estuvieran intentando conectarse a una m\xe1quina inexistente."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Return")," - esta regla devuelve el paquete a la cadena de origen para que pueda compararlo con otras reglas."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Reject")," - el cortafuegos rechaza el paquete y env\xeda un error al dispositivo de conexi\xf3n.")),(0,r.kt)("h2",{id:"instalaci\xf3n-de-iptables"},"Instalaci\xf3n de Iptables"),(0,r.kt)("p",null,"Ejecutar los siguientes comandos uno a uno:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo apt-get update\nsudo apt-get install iptables\n")),(0,r.kt)("p",null,"En el caso de necesitar arracar iptables existen los comandos:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo systemctl enable iptables\nsudo systemctl start iptables\n")),(0,r.kt)("p",null,"Para verificar el estado del servicio ejecutar el comando:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo systemctl status iptables\n")),(0,r.kt)("p",null,"Comprobar el estado de la configuraci\xf3n actual de iptables ejecutando:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo iptables -L -v\n")),(0,r.kt)("p",null,"La opci\xf3n ",(0,r.kt)("strong",{parentName:"p"},"-L")," se utiliza para listar todas las reglas, y ",(0,r.kt)("strong",{parentName:"p"},"-v")," (verbose) para mostrar la informaci\xf3n en un formato m\xe1s detallado."),(0,r.kt)("p",null,"El sistema muestra el estado de sus cadenas. La salida mostrar\xe1 una lista de tres cadenas:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"\nChain INPUT (policy ACCEPT)\n\nChain FORWARD (policy ACCEPT)\n\nChain OUTPUT (policy ACCEPT)\n")),(0,r.kt)("p",null,"Ahora ya estar\xe1 instalado el cortafuegos en Linux. En este punto, se puede observar que todas las conexiones est\xe1n configuradas como ACEPTAR y no hay reglas. Eso no es seguro ya que cualquier paquete puede pasar sin ser filtrado."),(0,r.kt)("h2",{id:"comandos-m\xe1s-habituales"},"Comandos m\xe1s habituales"),(0,r.kt)("p",null,"Esta es una lista de algunas de las opciones comunes de iptables:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"-A --append - A\xf1ade una regla a una cadena (al final)."),(0,r.kt)("li",{parentName:"ul"},"-C --check - Busca una regla que coincida con los requisitos de la cadena."),(0,r.kt)("li",{parentName:"ul"},"-D --delete - Elimina las reglas especificadas de una cadena."),(0,r.kt)("li",{parentName:"ul"},"-F --flush - Elimina todas las reglas."),(0,r.kt)("li",{parentName:"ul"},"-I --insert - A\xf1ade una regla a una cadena en una posici\xf3n determinada."),(0,r.kt)("li",{parentName:"ul"},"-L --list - Mostrar todas las reglas de una cadena."),(0,r.kt)("li",{parentName:"ul"},"-N -new-chain - Crear una nueva cadena."),(0,r.kt)("li",{parentName:"ul"},"-v --verbose - Muestra m\xe1s informaci\xf3n cuando se utiliza una opci\xf3n de lista."),(0,r.kt)("li",{parentName:"ul"},"-X --delete-chain - Elimina la cadena proporcionada.")),(0,r.kt)("p",null,"Iptables distingue entre may\xfasculas y min\xfasculas (",(0,r.kt)("em",{parentName:"p"},"Case Sensitive"),"), as\xed que hay que verificar la utilizaci\xf3n de las opciones correctas."),(0,r.kt)("h2",{id:"definir-las-reglas-de-la-cadena"},"Definir las reglas de la cadena"),(0,r.kt)("p",null,"Definir una regla significa a\xf1adirla a la cadena. Para ello, es necesario insertar la opci\xf3n ",(0,r.kt)("strong",{parentName:"p"},"-A")," (Append) justo despu\xe9s del comando iptables, de la siguiente manera:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo iptables -A\n")),(0,r.kt)("p",null,"Este comando alertar\xe1 a iptables de que est\xe1 a\xf1adiendo nuevas reglas a una cadena. Se puede combinar el comando con otras opciones, tales como:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"-i")," (interfaz) - la interfaz de red cuyo tr\xe1fico desea filtrar, como eth0, lo, ppp0, etc."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"-p")," (protocolo) - el protocolo de red donde se realiza el filtrado. Puede ser tcp, udp, udplite, icmp, sctp, icmpv6, etc. Tambi\xe9n es posible escribir all para seleccionar todos los protocolos."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"-s")," (source) - la direcci\xf3n de la que proviene el tr\xe1fico. Se puede a\xf1adir un nombre de host o una direcci\xf3n IP."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"-dport")," (puerto de destino) - el n\xfamero de puerto de destino de un protocolo, como 22 (SSH), 443 (https), etc."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"-j")," (destino) - el nombre del destino (ACCEPT, DROP, RETURN). Es necesario insertar esto cada vez que se establece una nueva regla.")),(0,r.kt)("p",null,"Si se desea hacer uso de todas ellas, se debe escribir el comando en este orden:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo iptables -A <chain> -i <interface> -p <protocol (tcp/udp) > -s <source> --dport <port no.>  -j <target>\n")),(0,r.kt)("h2",{id:"permitir-el-tr\xe1fico-en-localhost"},"Permitir el tr\xe1fico en Localhost"),(0,r.kt)("p",null,"Para permitir el tr\xe1fico en localhost, escribir el siguiente comando:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo iptables -A INPUT -i lo -j ACCEPT\n")),(0,r.kt)("p",null,"Se utiliza lo o loopback interface para todas las comunicaciones en el localhost. El comando anterior se asegura de que las conexiones entre una base de datos y una aplicaci\xf3n web en la misma m\xe1quina funcionan correctamente."),(0,r.kt)("h2",{id:"permitir-conexiones-a-trav\xe9s-de-los-puertos-http-ssh-y-ssl"},"Permitir conexiones a trav\xe9s de los puertos HTTP, SSH y SSL"),(0,r.kt)("p",null,"Si se desea que las conexiones ",(0,r.kt)("strong",{parentName:"p"},"HTTP")," (puerto ",(0,r.kt)("strong",{parentName:"p"},"80"),"), ",(0,r.kt)("strong",{parentName:"p"},"HTTPS")," (puerto ",(0,r.kt)("strong",{parentName:"p"},"443"),") y ",(0,r.kt)("strong",{parentName:"p"},"SSH")," (puerto ",(0,r.kt)("strong",{parentName:"p"},"22"),") funcionen normalmente. Para ello, es necesario especificar el protocolo (",(0,r.kt)("strong",{parentName:"p"},"-p"),") y el puerto correspondiente (",(0,r.kt)("strong",{parentName:"p"},"-dport"),"). Estos comandos se pueden ejecutar uno a uno:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT\nsudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT\nsudo iptables -A INPUT -p tcp --dport 443 -j ACCEPT\n")),(0,r.kt)("p",null,"Las opciones funcionan de la siguiente manera:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"-p - Comprueba el protocolo especificado (tcp)."),(0,r.kt)("li",{parentName:"ul"},"--dport - Especifica el puerto de destino."),(0,r.kt)("li",{parentName:"ul"},"-j jump - Realiza la acci\xf3n especificada.")),(0,r.kt)("p",null,"Verificar si las reglas han sido a\xf1adidas en iptables:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo iptables -L -v\n")),(0,r.kt)("h3",{id:"permitir-s\xf3lo-ssh"},"Permitir s\xf3lo SSH"),(0,r.kt)("p",null,"Para permitir s\xf3lo conexiones SSH de entrada y conexiones loopback, se puede utilizar la siguiente configuraci\xf3n."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"-A INPUT -p tcp -m state --state RELATED,ESTABLISHED -j ACCEPT\n-A INPUT -i lo -j ACCEPT\n-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT\n-A INPUT -j REJECT\n-A FORWARD -j REJECT\n")),(0,r.kt)("h2",{id:"filtrado-de-paquetes-basado-en-el-origen-source"},"Filtrado de paquetes basado en el origen (SOURCE)"),(0,r.kt)("p",null,"Iptables permite filtrar paquetes bas\xe1ndose en una direcci\xf3n IP o en un rango de direcciones IP. Es necesario especificarlo con la opci\xf3n -s. Por ejemplo, para aceptar paquetes desde ",(0,r.kt)("strong",{parentName:"p"},"192.168.1.5"),", el comando es:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo iptables -A INPUT -s 192.168.1.5 -j ACCEPT\n")),(0,r.kt)("p",null,"Tambi\xe9n se pueden rechazar paquetes de una direcci\xf3n IP concreta sustituyendo el objetivo ",(0,r.kt)("strong",{parentName:"p"},"ACCEPT")," por ",(0,r.kt)("strong",{parentName:"p"},"DROP"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo iptables -A INPUT -s 192.168.1.5 -j DROP\n")),(0,r.kt)("p",null,"Si se desea descartar paquetes de un determinado rango de direcciones IP, se debe utilizar la opci\xf3n -m y el m\xf3dulo iprange. A continuaci\xf3n, especificar el rango de direcciones IP con -src-range. Recordar, que un gui\xf3n debe separar el rango de direcciones ip sin dejar espacio, de la siguiente manera:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo iptables -A INPUT -m iprange --src-range 192.168.1.100-192.168.1.200 -j DROP\n")),(0,r.kt)("p",null,"Las opciones de iptables utilizadas en los ejemplos funcionan de la siguiente manera:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"-m - Coincide con la opci\xf3n especificada."),(0,r.kt)("li",{parentName:"ul"},"-iprange - Indica al sistema que espere un rango de direcciones IP en lugar de una sola."),(0,r.kt)("li",{parentName:"ul"},"--src-range - Identifica el rango de direcciones IP.")),(0,r.kt)("h2",{id:"descartar-drop-el-resto-del-tr\xe1fico"},"Descartar (DROP) el resto del tr\xe1fico"),(0,r.kt)("p",null,"Es crucial utilizar el objetivo ",(0,r.kt)("strong",{parentName:"p"},"DROP")," para el resto del tr\xe1fico despu\xe9s de definir las reglas ",(0,r.kt)("strong",{parentName:"p"},"-dport"),". Esto evitar\xe1 que una conexi\xf3n no autorizada acceda al servidor a trav\xe9s de otros puertos abiertos. Para conseguirlo, simplemente basta con introducir el comando:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo iptables -A INPUT -j DROP\n")),(0,r.kt)("p",null,"Ahora, las conexiones que no se ajusten al puerto especificado se descartar\xe1n."),(0,r.kt)("h2",{id:"borrar-reglas"},"Borrar Reglas"),(0,r.kt)("p",null,"Si se desea eliminar todas las reglas y empezar de cero, se puede utilizar la opci\xf3n -F (flush):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo iptables -F\n")),(0,r.kt)("p",null,"Este comando borra todas las reglas actuales. Sin embargo, para borrar una regla espec\xedfica, se debe utilizar la opci\xf3n -D. En primer lugar, es necesario ver todas las reglas disponibles introduciendo el siguiente comando:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo iptables -L --line-numbers\n")),(0,r.kt)("p",null,"Se obtiene un listado de reglas numeradas."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"\nChain INPUT (policy ACCEPT)\n\nnum  target     prot opt source               destination\n\n1    ACCEPT     all -- 192.168.0.4          anywhere\n2    ACCEPT     tcp -- anywhere             anywhere tcp dpt:https\n3    ACCEPT     tcp -- anywhere             anywhere tcp dpt:http\n4    ACCEPT     tcp -- anywhere             anywhere tcp dpt:ssh\n\n")),(0,r.kt)("p",null,"Para eliminar una regla, basta con introducir la respectiva cadena y el n\xfamero de la lista. Digamos que para este tutorial de iptables, queremos eliminar la regla n\xfamero dos de la lista INPUT. El comando deber\xeda ser:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo iptables -D INPUT 2\n")),(0,r.kt)("h2",{id:"cambios-permanentes"},"Cambios permanentes"),(0,r.kt)("p",null,"Las reglas creadas en iptables se guardan en memoria, por lo que deben ser almacenadas en un archivo para su posterior carga despu\xe9s de un reinicio.",(0,r.kt)("br",{parentName:"p"}),"\n","Para realizar estas modificaciones, se pueden utilizar los comandos correspondientes seg\xfan se trate de reglas IPv4 o IPv6."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo iptables-save > /etc/iptables/rules.v4\nsudo iptables-save > /etc/iptables/rules.v6\n")),(0,r.kt)("p",null,"Ahora cada vez que se reinicie el VPS tendr\xe1 que cargar las reglas guardadas con los siguientes comandos:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo iptables-restore < /etc/iptables/rules.v4\nsudo iptables-restore < /etc/iptables/rules.v6\n")),(0,r.kt)("p",null,"Si se desea que el proceso de carga sea completamente autom\xe1tico, se puede configurar el paquete iptables-persistent y \xe9l se encargar\xe1 de cargar las reglas autom\xe1ticamente."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"sudo apt-get install iptables-persistent\n")),(0,r.kt)("h2",{id:"recursos"},"Recursos"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.sobyte.net/post/2022-04/understanding-netfilter-and-iptables/"},"https://www.sobyte.net/post/2022-04/understanding-netfilter-and-iptables/")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.digitalocean.com/community/tutorials/iptables-essentials-common-firewall-rules-and-commands"},"https://www.digitalocean.com/community/tutorials/iptables-essentials-common-firewall-rules-and-commands")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://sbarjatiya.com/website/tutorials/iptables/iptables.pdf"},"https://sbarjatiya.com/website/tutorials/iptables/iptables.pdf")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.comparitech.com/net-admin/beginners-guide-ip-tables/"},"https://www.comparitech.com/net-admin/beginners-guide-ip-tables/")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.digitalocean.com/community/tutorials/a-deep-dive-into-iptables-and-netfilter-architecture"},"https://www.digitalocean.com/community/tutorials/a-deep-dive-into-iptables-and-netfilter-architecture")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.digitalocean.com/community/tutorials/how-to-list-and-delete-iptables-firewall-rules"},"https://www.digitalocean.com/community/tutorials/how-to-list-and-delete-iptables-firewall-rules")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.linuxadictos.com/como-configurar-el-firewall-en-linux-con-iptables.html"},"https://www.linuxadictos.com/como-configurar-el-firewall-en-linux-con-iptables.html"))))}d.isMDXComponent=!0}}]);